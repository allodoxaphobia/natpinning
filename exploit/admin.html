<html>
	<head>
		<title>Gremwell NAT Pinning test suite</title>
	</head>
	<body onload="">
	 <script type="text/javascript" src="tools.js"></script>
	 <script type="text/javascript" src="admin.js"></script>
	<link rel="STYLESHEET" type="text/css" media="screen" href="admin.css" />
	 <script language="JavaScript">
			function loadSWF(){
				try{
					var proto = "cmd";
					var server = document.location.hostname;//defaulting to same host
					var callbackip = "";
					var callbackport = "";
					//where dragons be
					//var swfEl = createSwfObject('exploit.swf', {id: 'myid', class: 'myclass', width: 1, height: 1}, {wmode: 'transparent',allowScriptAccess: 'allways', FlashVars : 'ci='+ gClientId +'&server='+ server +'&cmdURL='+gCmdURL});
					//document.body.appendChild(swfEl);
					var swfEL = httpreq(gCmdURL + "?GENFLASH_"+gClientId+"_"+getHostAndPortFromURL());
					document.getElementById("SWFContainer").innerHTML=swfEL;
					return true;
				}catch(err){
					return false;
				}
			}
			function nextStep(){
				if (gCurrStep==1){
					var strMyIp = document.getElementById("step1_myIP").value;
					document.getElementById("page_help").innerHTML="<a href='https://github.com/allodoxaphobia/natpinning/wiki/WebGui-Step2' target='_blank'>Help</a>";
					if(isValidIp4(strMyIp)){
						gMyIP=strMyIp;
						gClientId = regclient(gMyIP);
						if (gClientId!=""){
							//display step 2 page
							gCurrStep=2;
							displayStep("Step2");
							hideNextButton(document.getElementById("step_next"),true);
							//create default tests"
							for (var i = 0; i < gProtocols.length; i++){
								addTest(gProtocols[i],gMyIP,getNextPort());
							}
							if (loadSWF()){ //loading of SWF will trigger execution of tests
								//loop for test results...
								 updateBaseCheck();
							}else{
								document.getElementById("Errmsg").innerHTML="Failed to load SWF file.";
							}
						}else{
							hideNextButton(document.getElementById("step_next"),false);
							document.getElementById("Errmsg").innerHTML="Failed to retrieve client id from server.";
						}
					}else{
						document.getElementById("Errmsg").innerHTML="Invalid IP address.";
						document.getElementById("step1_myIP").focus();
					}
				}else{
					if (gCurrStep==2){
							document.getElementById("page_help").innerHTML="<a href='https://github.com/allodoxaphobia/natpinning/wiki/WebGui-Step3' target='_blank'>Help</a>";
							gCurrStep=3;
							displayStep("Step3")
							var tmpTests = gTests;
							//resetTestArray
							gTests = []
							hideNextButton(document.getElementById("step_next"),true);
							for (var i = 0; i < tmpTests.length; i++){
								if (tmpTests[i].RESULT=="True"){//supported protocol
									addTest(tmpTests[i].PROTO,gMyIP,"80");
									addTest(tmpTests[i].PROTO,otherIP(gMyIP),getNextPort());
									document.getElementById("step3_results_lowport").innerHTML+= "<li id='step3_low_port_"+ tmpTests[i].PROTO+"'>"+tmpTests[i].PROTO+" ...</li>";
									document.getElementById("step3_results_otherhost").innerHTML+= "<li id='step3_other_"+ tmpTests[i].PROTO+"'>"+tmpTests[i].PROTO+" ...</li>";
								}
							}
							setTimeout(updateBaseAndOtherHostPortCheck,5000);		
					}else{
						if (gCurrStep==3){
							document.location="exploit.html?ci="+escape(gClientId);
						}
					}
				}
			}
	 </script>
	 <p>
	<div id="Step1" class="MainContainer">
		<center><img src="gremwell_logo.png" class="img_logo" /></center>
		<div class="main_text">To continue, we will require the following information from you:</div>
			<br /><br />
			<div class="main_text">Your client's IP address: <input class="step_input" id="step1_myIP" value="" len="15"></div>
			<br /><br />
	</div>
	<div id="Step2" class="MainContainer_hidden">
		<div class="main_text"><br />We are now going to determine which connection tracking modules are loaded on your gateway.
		<br />
		<ul>
			<li id="li_FTP">FTP ...</li>
			<li id="li_IRC">IRC ...</li>
			<li id="li_SIP">SIP ...</li>			
			<li id="li_H225">H225 ...</li>
		</ul>
		</div>
	</div>
	<div id="Step3" class="MainContainer_hidden">
		<div class="main_text"><br />Now that we identified the supported protcols, we are going to check them for exploitation.
			<br><br>Support for reserved ports:
			<ul id="step3_results_lowport">
			</ul>
			<br>Support for forward to 3rd party:
			<ul id="step3_results_otherhost">
			</ul>
		</div>
	</div>
	<div id="ButtonFrame" class="ButtonFrame">
		<div id="Errmsg" class="errmsg"> </div>
		<center><input type=button class=step_next id=step_next onclick="nextStep();" value="Proceed"/></center>
		<br><div class="help_link" id="page_help"><a href='https://github.com/allodoxaphobia/natpinning/wiki/WebGui-Step1' target='_blank'>Help</a></div>
	</div>
	<div id="SWFContainer"></div>
	 </center>
	</body>
</html>
