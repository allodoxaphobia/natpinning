/* 						GLOBAL VARIABLES				 */
var gCurrStep=1;

var gRandPort = 65000;
//function httpreq()	=>	tools.js

function getNextPort(){
	gRandPort = gRandPort +1
	return gRandPort.toString()
}

function regclient(ip){
	return httpreq(gCmdURL + "?REG_"+gMyIP); 
	//returns client id or empty string on error
}

var gSteps =["Step1", "Step2", "Step3"]

function displayStep(sID){
	for (var i = 0; i < gSteps.length; i++){
		lElement = document.getElementById(gSteps[i]);
		if (gSteps[i]==sID){
			hideMainFrame(lElement,false);
		}else{
			hideMainFrame(lElement,true); 
		}
	}
	document.getElementById("Errmsg").innerHTML=" ";
}


var updateBaseCheck_interval;
function updateBaseCheck(){
	//this is required because calling setTimeout from a function called with setTimeout doesn' work on old IE versions...
	updateBaseCheck_interval = setInterval(_updateBaseCheck,2000);
}
function _updateBaseCheck(){
	var done_count = 0;
	done_count=0;
	for (var i = 0; i < gTests.length; i++){
		updateTest(gTests[i]); // will only fire if status != DONE
		if (gTests[i].STATUS=="DONE"){
			var lElement = document.getElementById("li_"+ gTests[i].PROTO);
			lElement.innerHTML = gTests[i].PROTO + "............." + gTests[i].RESULT;
			done_count = done_count +1;
		}
	}
	if (done_count<gTests.length){
		return 0;
	}else{
		var okCount = 0;
		for (var i = 0; i < gTests.length; i++){
			if (gTests[i].RESULT=="True"){okCount = okCount+1};
		}
		if (okCount>0){
			hideNextButton(document.getElementById("step_next"),false);
		}else{
			document.getElementById("Errmsg").innerHTML="No connection tracking modules were identified.";
		}
		clearInterval(updateBaseCheck_interval);
	}
}

var updateBaseAndOtherHostPortCheck_interval;
function updateBaseAndOtherHostPortCheck(){
	updateBaseAndOtherHostPortCheck_interval = setInterval(_updateBaseAndOtherHostPortCheck,2000);
}
function _updateBaseAndOtherHostPortCheck(){
	//blocking function
	var done_count = 0;
	done_count=0;
	for (var i = 0; i < gTests.length; i++){
		updateTest(gTests[i]); // will only fire if status != DONE
		if (gTests[i].STATUS=="DONE"){
			if (gTests[i].PRIV_IP==gMyIP){
				//port test
				var lElement = document.getElementById("step3_low_port_"+ gTests[i].PROTO);
			}else{
				//host test			
				var lElement = document.getElementById("step3_other_"+ gTests[i].PROTO);
			}
			lElement.innerHTML = gTests[i].PROTO + "............." + gTests[i].RESULT;
			done_count = done_count +1;
		}
	}
	if (done_count<gTests.length){
		return 0;
	}else{
		hideNextButton(document.getElementById("step_next"),false);
		clearInterval(updateBaseAndOtherHostPortCheck_interval);
	}
}

